<!DOCTYPE html>
<html id="html">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>

    <!-- html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

    <!-- Dojo CDN Script -->
    <script
      data-dojo-Config="parseOnLoad: true"
      src="https://ajax.googleapis.com/ajax/libs/dojo/1.14.1/dojo/dojo.js"
    ></script>

    <style>
      * {
        padding: 0;
        margin: 0;
      }

      #cont {
        background-color: pink;
        border-bottom-left-radius: 25px;
        border-bottom-right-radius: 25px;
        padding-bottom: 25px;
        margin-bottom: 50px;
      }
      #header,
      #badge {
        color: darkblue;
      }
      #badge > span {
            font-weight: bolder;
		    font-size: 20px;
		    margin-top: 15px;
	        margin-bottom: 20px;
      }
      hr {
        background-color: darkblue;
        height: 2px;
        border-width: 0;
      }

      #formBody {
        background-color: white;
        border-radius: 16px;
      }
      #formBody > hr,
      #rowBody > hr {
        background-color: grey;
        height: 2px;
        border-width: 0;
      }

      #license > span {
        font-weight: bolder;
        font-size: 150%;
        color: darkblue;
      }
      
      p {
        background-color: darkblue;
        color: white;
      }
      
      
      

#cont {
    background-color: #EFEFFF !important;
}
#header {
	border-bottom: 1px solid #bababa;
	border-bottom: 1px solid #bababa;
    height: 140px
}

#header img {
	height: 100px !important;
    margin: 20px !important;
    float:right;
}
#header > span {
font-weight: bolder;
    font-size: 20px;
    float: right;
    margin-right: 10px;
    margin-top: 50px;
}
#formBody .row_item {
    padding: 5px 0px;
    border-bottom: 2px solid #c3c3c3;
}
#formBody .row_item:last-child {
	 border-bottom: 0px solid #c3c3c3;
}

#formBody .row_item span {
font-size: 12px;
    font-weight: bold;
   }
   
   #cont2 {
   		padding: 0px 50px !important;
   }


    </style>

    <title>Licenses</title>
  </head>

  <body id="body">
    <!-- container body -->
    <div class="container-xxl px-5" id="cont">
      <!-- head body -->
      <div id="header">
      	<img src="image/logo_ds.svg" alt="DataServe Logo" />
        <span class="text-end">
          الشركة&#160;الوطنية&#160;لخدمة&#160;البيانات&#160;والحلول&#160;المتكاملة
          <br />National DataServe & Turnkey Solution Co
        </span>
        
      </div>

      <div class="d-flex align-items-center justify-content-between text-end" id="badge">
        <img src="" alt="QRCode" id="qrcode">
        <span>
          رخصة&#160;إثبات&#160;الاستحقاق
          <br />Software license Proof of Entitlements
        </span>
      </div>
     

      <!-- form body -->
      <div id="formBody" class="py-3 px-4 mb-3">
        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>DataServe Customer Name</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="customerName"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>اسم&#160;العميل&#160;لدى&#160;داتاسيرف</span>
            </div>
          </div>
        </div>
      

       <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>DataServe Customer Number</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="customerNumber"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>رقم&#160;العميل&#160;لدى&#160;داتاسيرف</span>
            </div>
          </div>
        </div>
 

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>DataServe Site Number</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="siteNumber"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>رقم&#160;موقع&#160;داتاسيرف</span>
            </div>
          </div>
        </div>
    

       <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>Project Name as per RFP</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="projectName"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>اسم&#160;المشروع</span>
            </div>
          </div>
        </div>
   

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>Christening Number</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="christeningNumber"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>رقم&#160;التعميد</span>
            </div>
          </div>
        </div>
    

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>Christening Date</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="christeningDate"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>تاريخ&#160;التعميد</span>
            </div>
          </div>
        </div>
     

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>Customer P.O Reference Number</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="poNumber"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>رقم&#160;العقد</span>
            </div>
          </div>
        </div>
    

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>P.O Date</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="poDate"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>تاريخ&#160;العقد</span>
            </div>
          </div>
        </div>
       

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>Customer Contact</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="customerContact"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>رقم&#160;التواصل&#160;بالعميل</span>
            </div>
          </div>
        </div>
      

        <div class="row_item">
          <div class="row">
            <div class="col-sm-4">
              <span>Address</span>
            </div>
            <div class="col-sm-4 text-center">
              <span id="address"></span>
            </div>
            <div class="col-sm-4 text-end">
              <span>عنوان&#160;العميل</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- row body -->
    <div id="cont2">
      <div class="d-flex align-items-center justify-content-between text-end mb-4" id="license">
        <span>Licenses List</span>
        <span>قائمة&#160;الرخص</span>
      </div>
      <div id="rowBody" class="text-center">
        <div class="mb-3 row">
          <div class="col-sm-3 px-0">
            <p>الكمية<br />Quantity</p>
            <span id="quantity1"></span>
          </div>

          <div class="col-sm-3 px-0">
            <p>النوع<br />Type</p>
            <span id="kind1"></span>
          </div>

          <div class="col-sm-3 px-0">
            <p>الوصف<br />Description</p>
            <span id="description1"></span>
          </div>

          <div class="col-sm-3 px-0">
            <p>الرقم<br />Part Number</p>
            <span id="partNumber1"></span>
          </div>
        </div>
        <hr />
      </div>
    </div>

    <input type="hidden" id="counter" name="counter" value="1" />

    <script>
      var cnt = 1;
      var jsonObj;

      require([
        "dojo",
        "dojo/dom",
        "dojo/on",
        "dojo/request",
        "dojo/dom-construct",
        "dojo/dom-form",
        "dojo/domReady!"
      ], function (dojo, dom, on, request, domConstruct, domForm) {
        var rowBody = dom.byId("rowBody");
        var qrcode = dom.byId("qrcode");

        var customerName = dom.byId("customerName");
        var customerNumber = dom.byId("customerNumber");
        var siteNumber = dom.byId("siteNumber");
        var projectName = dom.byId("projectName");
        var christeningNumber = dom.byId("christeningNumber");
        var christeningDate = dom.byId("christeningDate");
        var poNumber = dom.byId("poNumber");
        var poDate = dom.byId("poDate");
        var customerContact = dom.byId("customerContact");
        var address = dom.byId("address");
        var quantity1 = dom.byId("quantity1");
        var kind1 = dom.byId("kind1");
        var description1 = dom.byId("description1");
        var partNumber1 = dom.byId("partNumber1");
        var counter = dom.byId("counter");

        // data collector
        dojo.ready(function () {
          async function pageMaker(){
          await request
            .post("edit.jsp", {
              data: { poNumber: window.location.search.substring(10) }
            })
            .response.then(
              function (response) {
                jsonObj = response.data;
                var data = JSON.parse(response.data);
                customerName.innerHTML = data.customerName.replace(new RegExp(" ", 'g'), "&#160;");
                customerNumber.innerHTML = data.customerNumber.replace(new RegExp(" ", 'g'), "&#160;");
                siteNumber.innerHTML = data.siteNumber.replace(new RegExp(" ", 'g'), "&#160;");
                projectName.innerHTML = data.projectName.replace(new RegExp(" ", 'g'), "&#160;");
                christeningNumber.innerHTML = data.christeningNumber.replace(new RegExp(" ", 'g'), "&#160;");
                christeningDate.innerHTML = data.christeningDate.replace(new RegExp(" ", 'g'), "&#160;");
                poNumber.innerHTML = data.poNumber.replace(new RegExp(" ", 'g'), "&#160;");
                poDate.innerHTML = data.poDate.replace(new RegExp(" ", 'g'), "&#160;");
                customerContact.innerHTML = data.customerContact.replace(new RegExp(" ", 'g'), "&#160;");
                address.innerHTML = data.address.replace(new RegExp(" ", 'g'), "&#160;");
                var quantity = data.quantity.split("#");
                var kind = data.kind.split("#");
                var description = data.description.split("#");
                var partNumber = data.partNumber.split("#");
                quantity1.innerHTML = quantity[0];
                kind1.innerHTML = kind[0].replace(new RegExp(" ", 'g'), "&#160;");
                description1.innerHTML = description[0].replace(new RegExp(" ", 'g'), "&#160;");
                partNumber1.innerHTML = partNumber[0].replace(new RegExp(" ", 'g'), "&#160;");
                counter.setAttribute("value", data.counter);
                cnt = data.counter;

                for (var i = 2; i <= counter.value; i++) {
                  var row = domConstruct.toDom(
                    `<div class="mb-3 row">
                      <div class="col-sm-3 px-0">
                        <span>${Number(quantity[i - 1])}</span>
                      </div>

                      <div class="col-sm-3 px-0">      
                        <span>${kind[i - 1]}</span>
                      </div>

                      <div class="col-sm-3 px-0">      
                        <span>${description[i - 1]}</span>
                      </div>

                      <div class="col-sm-3 px-0">      
                        <span>${partNumber[i - 1]}</span>
                      </div>
                    </div>
                    <hr />`
                  );

                  domConstruct.place(row, rowBody, "last");
                }
                
                // qr img src
                qrcode.src = `https://api.qrserver.com/v1/create-qr-code/?data=${jsonObj}&size=100x100`;
              },
              function (error) {
                console.log("error: " + error);
              }
            );
          }

          // pdf code
          async function pdfMaker() {
            await pageMaker();
            const invoice = document.getElementById("body");
            var opt = {
              margin: 0,
              filename: window.location.search.substring(10) + ".pdf",
              image: { type: "jpeg", quality: 1 },
              html2canvas: { scale: 2 },
              jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
            };
            html2pdf().from(invoice).set(opt).save();
          }
          
          pdfMaker();
        });
      });
    </script>
  </body>
</html>
